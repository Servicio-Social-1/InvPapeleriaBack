"use strict";(self.webpackChunkgestionPapeleriaUI=self.webpackChunkgestionPapeleriaUI||[]).push([[780],{4780:(E,c,n)=>{n.r(c),n.d(c,{InventoryModule:()=>Y});var l=n(6895),h=n(3060),u=n(2094),d=n(3632),e=n(4650),S=n(3589),b=n(9215),v=n(5134),p=n(3935),m=n(6228),g=n(8762),y=n(7881),f=n(4159),A=n(4859),I=n(7791),C=n(5609),T=n(7117);function D(i,o){if(1&i&&e._UZ(0,"app-table",6),2&i){const t=e.oxw();e.Q6J("dataToDisplay",t.articles)("displayedColumns",t.columns)("errorMsg",t.errorMsg)}}function x(i,o){if(1&i&&e._UZ(0,"app-table",6),2&i){const t=e.oxw();e.Q6J("dataToDisplay",t.articlesFromSearch)("displayedColumns",t.columns)("errorMsg",t.errorMsg)}}const M=[{path:"",component:(()=>{class i{constructor(t,s,r,a,$,z,Z,L){this.dialogService=t,this.inventoryService=s,this.loadingService=r,this.paginatorService=a,this.searchStoreService=$,this.inventoryStore=z,this.tableStoreService=Z,this.authService=L,this.articleCount=1,this.limitAndOffsetAndSize={limit:25,offset:0},this.isSearching=!1,this.columns=[],this.paginatorState=u.r}ngOnInit(){this.loadingService.toggleLoading(!0),this.tableStoreService.setTableContext("inventory"),this.paginatorService.reset(),this.userStatusSubs=this.authService.adminStatus().subscribe(t=>{this.isAdmin=t,this.deleteArticleSubs=this.tableStoreService.rowToRemove$.subscribe(s=>this.handleDeleteArticle(s)),this.newArticleSubs=this.inventoryStore.newArticle$.subscribe(s=>{this.articles.length<25&&(s.options=["edit","delete"],this.articles.push(s),this.articles=[...this.articles])}),this.updatedArticleSubs=this.inventoryStore.updatedArticle$.subscribe(s=>{const r=this.articles.findIndex(a=>a.id===s.id);this.articles[r]=s,this.articles=[...this.articles]}),this.loadingSubs=this.loadingService.isLoading$.subscribe(s=>{this.isLoading=s}),this.articleCountSubs=this.inventoryService.getCount().subscribe(s=>{this.articleCount=s}),this.paginatorSubs=this.paginatorService.paginator$.subscribe(s=>{this.paginatorState=s,this.pageChanged(this.paginatorState)}),this.valueSearchSubs=this.searchStoreService.value$.subscribe(s=>this.handleValueSearchSubs(s)),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(s=>this.handleItemsFromSearch(s))})}handleItemsFromSearch(t){this.articlesFromSearch=t.map(s=>(s.options=["edit","delete"],s))}handleValueSearchSubs(t){this.isSearching=!!t}handleDeleteArticle(t){if(!this.articles.length)return;const s=this.articles.findIndex(r=>r.id===t?.id);this.articles.splice(s,1),this.articles=[...this.articles]}getArticles({limit:t,offset:s}){return this.inventoryService.getArticles({limit:t,offset:s}).subscribe({error:r=>this.setTableErrorData(r),next:r=>this.setTableData(r)})}setTableErrorData(t){this.columns=["id","description","stock","size","status"],this.isAdmin&&(this.columns.push("options"),this.columns=[...this.columns]),this.articles=[],this.errorMsg=t.error.message,this.loadingService.toggleLoading(!1)}setTableData(t){this.columns=["id","description","stock","size","status"],this.isAdmin&&(this.columns.push("options"),this.columns=[...this.columns]),t.forEach(s=>{this.isAdmin&&(s.options=["edit","delete"])}),this.articles=t,this.inventoryStore.updateDislayedArticles(t),this.loadingService.toggleLoading(!1)}pageChanged(t){this.paginatorState={...t},this.loadingService.toggleLoading(!0),this.articlesSubs=this.getArticles({limit:25,offset:25*t.pageIndex})}openDialog(){this.unsubscribeWhenOpenDialog(),this.dialogService.openDialog({component:d.R,callback:()=>{this.tableStoreService.setTableContext("inventory"),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(t=>this.handleItemsFromSearch(t)),this.valueSearchSubs=this.searchStoreService.value$.subscribe(t=>this.handleValueSearchSubs(t)),this.articleCountSubs=this.inventoryService.getCount().subscribe(t=>{this.articleCount=t}),this.searchStoreService.updateValue(""),this.deleteArticleSubs=this.tableStoreService.rowToRemove$.subscribe(t=>this.handleDeleteArticle(t))},data:{title:"Nuevo Art\xedculo"}})}unsubscribeWhenOpenDialog(){this.itemsFromSearchSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.searchStoreService.updateItems([]),this.deleteArticleSubs?.unsubscribe()}openReport(){this.inventoryService.getReport("inventory").subscribe(t=>{const s=URL.createObjectURL(t);window.open(s,"_blank")})}ngOnDestroy(){this.newArticleFormIsOpenSubs?.unsubscribe(),this.articleCountSubs?.unsubscribe(),this.articlesSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.loadingSubs?.unsubscribe(),this.paginatorSubs?.unsubscribe(),this.updatedArticleSubs?.unsubscribe(),this.newArticleSubs?.unsubscribe(),this.userStatusSubs?.unsubscribe(),this.deleteArticleSubs?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(S.x),e.Y36(b.V),e.Y36(v.b),e.Y36(p.w),e.Y36(m.y),e.Y36(g.w),e.Y36(y.B),e.Y36(f.e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-inventory"]],decls:11,vars:5,consts:[[3,"context"],["mat-raised-button","","color","primary",1,"button",3,"click"],["mat-raised-button","","color","accent",1,"button",3,"click"],[3,"dataToDisplay","displayedColumns","errorMsg",4,"ngIf","ngIfElse"],["searchTable",""],[3,"pageSize","count"],[3,"dataToDisplay","displayedColumns","errorMsg"]],template:function(t,s){if(1&t&&(e.TgZ(0,"h1"),e._uU(1,"Inventario"),e.qZA(),e.TgZ(2,"app-search",0)(3,"button",1),e.NdJ("click",function(){return s.openDialog()}),e._uU(4,"Agregar nuevo art\xedculo"),e.qZA(),e.TgZ(5,"button",2),e.NdJ("click",function(){return s.openReport()}),e._uU(6,"Reporte"),e.qZA()(),e.YNc(7,D,1,3,"app-table",3),e.YNc(8,x,1,3,"ng-template",null,4,e.W1O),e._UZ(10,"app-paginator",5)),2&t){const r=e.MAs(9);e.xp6(2),e.Q6J("context","inventory"),e.xp6(5),e.Q6J("ngIf",!s.isSearching)("ngIfElse",r),e.xp6(3),e.Q6J("pageSize",s.limitAndOffsetAndSize.limit)("count",s.articleCount)}},dependencies:[l.O5,A.lW,I.g,C.a,T.J],styles:["h1[_ngcontent-%COMP%]{margin:20px}.button[_ngcontent-%COMP%]{max-height:50px!important}"]}),i})()}];let F=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.Bz.forChild(M),h.Bz]}),i})();var O=n(82),R=n(5642),U=n(4006),J=n(529);let Y=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[l.ez,F,O.q,R.K,U.UX,J.JF]}),i})()}}]);