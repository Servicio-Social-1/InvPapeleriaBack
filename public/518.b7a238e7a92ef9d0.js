"use strict";(self.webpackChunkgestionPapeleriaUI=self.webpackChunkgestionPapeleriaUI||[]).push([[518],{6518:(Q,S,s)=>{s.r(S),s.d(S,{DepartureTicketModule:()=>E});var c=s(6895),b=s(3060),m=s(6400),T=s(2094),i=s(4650),D=s(3589),k=s(5804),f=s(5134),C=s(3935),x=s(6228),y=s(737),F=s(7881),I=s(4159),h=s(4859),g=s(7791),l=s(5609),M=s(7117);function $(r,o){if(1&r&&i._UZ(0,"app-table",5),2&r){const t=i.oxw();i.Q6J("dataToDisplay",t.departureTickets)("displayedColumns",t.columns)("errorMsg",t.errorMsg)}}function A(r,o){if(1&r&&i._UZ(0,"app-table",5),2&r){const t=i.oxw();i.Q6J("dataToDisplay",t.departureTicketsFromSearch)("displayedColumns",t.columns)("errorMsg",t.errorMsg)}}const O=[{path:"",component:(()=>{class r{constructor(t,e,a,p,L,N,W,Z){this.dialogService=t,this.departureTicketService=e,this.loadingService=a,this.paginatorService=p,this.searchStoreService=L,this.departureTicketStore=N,this.tableStoreService=W,this.authService=Z,this.departureTicketCount=1,this.limitAndOffsetAndSize={limit:25,offset:0},this.isSearching=!1,this.columns=[],this.paginatorState=T.r}ngOnInit(){this.loadingService.toggleLoading(!0),this.tableStoreService.setTableContext("departure-ticket"),this.paginatorService.reset(),this.userStatusSubs=this.authService.adminStatus().subscribe(t=>{this.isAdmin=t,this.listenDeleteDepartureTicketSubs=this.tableStoreService.listenRowToRemove$.subscribe(e=>e?this.deleteDepartureTicketSubs=this.tableStoreService.rowToRemove$.subscribe(a=>this.handleDeleteDepartureTicket(a)):this.deleteDepartureTicketSubs?.unsubscribe()),this.newDepartureTicketSubs=this.departureTicketStore.newDepartureTicket$.subscribe(e=>{this.departureTickets.length<25&&(this.departureTickets.push(e),this.departureTickets=[...this.departureTickets])}),this.updatedDepartureTicketSubs=this.departureTicketStore.updatedDepartureTicket$.subscribe(e=>{const a=this.departureTickets.findIndex(p=>p.id===e.id);this.departureTickets[a]=e,this.departureTickets=[...this.departureTickets]}),this.loadingSubs=this.loadingService.isLoading$.subscribe(e=>{this.isLoading=e}),this.departureTicketCountSubs=this.departureTicketService.getCount().subscribe(e=>{this.departureTicketCount=e}),this.paginatorSubs=this.paginatorService.paginator$.subscribe(e=>{this.paginatorState=e,this.pageChanged(this.paginatorState)}),this.valueSearchSubs=this.searchStoreService.value$.subscribe(e=>this.handleValueSearchSubs(e)),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(e=>this.handleItemsFromSearch(e)),this.listeningSearchChangesSubs=this.searchStoreService.listenDepartureTicketSearchChanges$.subscribe(e=>{e?(this.tableStoreService.setTableContext("departure-ticket"),this.valueSearchSubs=this.searchStoreService.value$.subscribe(a=>this.handleValueSearchSubs(a)),this.departureTicketCountSubs=this.departureTicketService.getCount().subscribe(a=>{this.departureTicketCount=a}),this.searchStoreService.updateValue(""),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(a=>this.handleItemsFromSearch(a)),this.deleteDepartureTicketSubs=this.tableStoreService.rowToRemove$.subscribe(a=>this.handleDeleteDepartureTicket(a))):this.unsubscribeWhenOpenDialog()})})}unsubscribeWhenOpenDialog(){this.itemsFromSearchSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.searchStoreService.updateItems([]),this.deleteDepartureTicketSubs?.unsubscribe()}handleItemsFromSearch(t){this.departureTicketsFromSearch=t.map(e=>({area:e.area.name,petitioner:e.petitioner.name,user:e.user.email,id:e.id,date:e.date,time:e.time,status:e.status,options:this.isAdmin?["edit","picture_as_pdf","delete"]:["edit","picture_as_pdf"],articleExitDetail:e.articleExitDetail}))}handleDeleteDepartureTicket(t){if(!this.departureTickets.length)return;const e=this.departureTickets.findIndex(a=>a.id===t?.id);this.departureTickets.splice(e,1),this.departureTickets=[...this.departureTickets]}handleValueSearchSubs(t){this.isSearching=!!t}getDepartureTickets({limit:t,offset:e}){return this.departureTicketService.getDepartureTickets({limit:t,offset:e}).subscribe({error:a=>this.setTableErrorData(a),next:a=>this.setTableData(a)})}setTableErrorData(t){this.columns=["id","date","time","petitioner","area","user","options"],this.departureTickets=[],this.errorMsg=t?.error?.message,this.loadingService.toggleLoading(!1)}setTableData(t){this.columns=["id","date","time","petitioner","area","user","options"],this.departureTickets=t.map(e=>({id:e.id,date:e.date,time:e.time,petitioner:e.petitioner.name,area:e.area.name,user:e.user.email,options:this.isAdmin?["edit","picture_as_pdf","delete"]:["edit","picture_as_pdf"]})),this.departureTicketStore.updateDisplayedDepartureTickets(t),this.loadingService.toggleLoading(!1)}pageChanged(t){this.paginatorState={...t},this.loadingService.toggleLoading(!0),this.departureTicketsSubs=this.getDepartureTickets({limit:25,offset:25*t.pageIndex})}openNewDepartureTicketDialog(){this.unsubscribeWhenOpenDialog(),this.dialogService.openDialog({component:m.$,callback:()=>{this.tableStoreService.setTableContext("departure-ticket"),this.valueSearchSubs=this.searchStoreService.value$.subscribe(t=>this.handleValueSearchSubs(t)),this.departureTicketCountSubs=this.departureTicketService.getCount().subscribe(t=>{this.departureTicketCount=t}),this.searchStoreService.updateValue(""),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(t=>this.handleItemsFromSearch(t)),this.deleteDepartureTicketSubs=this.tableStoreService.rowToRemove$.subscribe(t=>this.handleDeleteDepartureTicket(t))},data:{title:"Nuevo vale de salida"}})}ngOnDestroy(){this.searchStoreService.updateValue(""),this.newDepartureTicketFormIsOpenSubs?.unsubscribe(),this.listenDeleteDepartureTicketSubs?.unsubscribe(),this.updatedDepartureTicketSubs?.unsubscribe(),this.departureTicketCountSubs?.unsubscribe(),this.departureTicketsSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.loadingSubs?.unsubscribe(),this.paginatorSubs?.unsubscribe(),this.newDepartureTicketSubs?.unsubscribe(),this.deleteDepartureTicketSubs?.unsubscribe(),this.userStatusSubs?.unsubscribe(),this.itemsFromSearchSubs?.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(D.x),i.Y36(k.G),i.Y36(f.b),i.Y36(C.w),i.Y36(x.y),i.Y36(y.y),i.Y36(F.B),i.Y36(I.e))},r.\u0275cmp=i.Xpm({type:r,selectors:[["app-departure-ticket"]],decls:9,vars:5,consts:[["findBy","Area, solicitante, email o usuario",3,"context"],["mat-raised-button","","color","primary",1,"button",3,"click"],[3,"dataToDisplay","displayedColumns","errorMsg",4,"ngIf","ngIfElse"],["searchTable",""],[3,"pageSize","count"],[3,"dataToDisplay","displayedColumns","errorMsg"]],template:function(t,e){if(1&t&&(i.TgZ(0,"h1"),i._uU(1,"Vales de salida"),i.qZA(),i.TgZ(2,"app-search",0)(3,"button",1),i.NdJ("click",function(){return e.openNewDepartureTicketDialog()}),i._uU(4,"Agregar nuevo vale de salida"),i.qZA()(),i.YNc(5,$,1,3,"app-table",2),i.YNc(6,A,1,3,"ng-template",null,3,i.W1O),i._UZ(8,"app-paginator",4)),2&t){const a=i.MAs(7);i.xp6(2),i.Q6J("context","departure-ticket"),i.xp6(3),i.Q6J("ngIf",!e.isSearching)("ngIfElse",a),i.xp6(3),i.Q6J("pageSize",e.limitAndOffsetAndSize.limit)("count",e.departureTicketCount)}},dependencies:[c.O5,h.lW,g.g,l.a,M.J],styles:["h1[_ngcontent-%COMP%]{margin:20px}.button[_ngcontent-%COMP%]{max-height:50px!important}"]}),r})()}];let J=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[b.Bz.forChild(O),b.Bz]}),r})();var Y=s(82),R=s(5642),u=s(4006),V=s(8442),v=s(7392),d=s(9549),B=s(3238),U=s(4385),z=s(4144),n=s(3546);let E=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[c.ez,J,Y.q,R.K,u.UX]}),r})();i.B6R(m.$,[c.sg,c.O5,v.Hw,h.lW,d.TO,d.KE,d.hX,B.ey,U.gD,z.Nt,n.a8,n.dn,n.n5,n.hq,g.g,l.a,u._Y,u.Fj,u.wV,u.JJ,u.JL,u.qQ,u.Fd,u.sg,u.u],[]),i.B6R(V.G,[v.Hw,h.lW,n.a8,n.dn,n.n5,n.hq,l.a],[])}}]);