"use strict";(self.webpackChunkgestionPapeleriaUI=self.webpackChunkgestionPapeleriaUI||[]).push([[218],{9218:(L,n,r)=>{r.r(n),r.d(n,{UsersModule:()=>O});var u=r(6895),l=r(5642),c=r(529),h=r(3060),d=r(2094),S=r(2544),e=r(4650),g=r(3589),m=r(1720),p=r(3302),b=r(5134),v=r(3935),f=r(6228),U=r(7881),C=r(7791),x=r(5609),y=r(7117),I=r(4859);function T(t,a){if(1&t&&e._UZ(0,"app-table",5),2&t){const s=e.oxw();e.Q6J("dataToDisplay",s.users)("displayedColumns",s.columns)("errorMsg",s.errorMsg)}}function M(t,a){if(1&t&&e._UZ(0,"app-table",5),2&t){const s=e.oxw();e.Q6J("dataToDisplay",s.usersFromSearch)("displayedColumns",s.columns)("errorMsg",s.errorMsg)}}const F=[{path:"",component:(()=>{class t{constructor(s,o,i,Y,$,z,Z){this.dialogService=s,this.usersService=o,this.usersStore=i,this.loadingService=Y,this.paginatorService=$,this.searchStoreService=z,this.tableStoreService=Z,this.userCount=1,this.limitAndOffsetAndSize={limit:25,offset:0},this.isSearching=!1,this.columns=[],this.paginatorState=d.r}ngOnInit(){this.loadingService.toggleLoading(!0),this.tableStoreService.setTableContext("user"),this.paginatorService.reset(),this.deleteUserSubs=this.tableStoreService.rowToRemove$.subscribe(s=>{if(!this.users.length)return;const o=this.users.findIndex(i=>i.id===s?.id);this.users.splice(o,1),this.users=[...this.users]}),this.newUserSubs=this.usersStore.newUser$.subscribe(s=>{this.users.length<25&&(s.options=["edit","delete"],this.users.push(s),this.users=[...this.users])}),this.updatedUserSubs=this.usersStore.updatedUser$.subscribe(s=>{const o=this.users.findIndex(i=>i.id===s.id);this.users[o]=s,this.users=[...this.users]}),this.loadingSubs=this.loadingService.isLoading$.subscribe(s=>{this.isLoading=s}),this.userCountSubs=this.usersService.getCount().subscribe(s=>{this.userCount=s}),this.paginatorSubs=this.paginatorService.paginator$.subscribe(s=>{this.paginatorState=s,this.pageChanged(this.paginatorState)}),this.valueSearchSubs=this.searchStoreService.value$.subscribe(this.handleValueSearchSubs),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(this.handleItemsFromSearch)}handleItemsFromSearch(s){this.usersFromSearch=s.map(o=>(o.options=["edit","delete"],o))}handleValueSearchSubs(s){return this.isSearching=!!s}getUsers({limit:s,offset:o}){return this.usersService.getUsers({limit:s,offset:o}).subscribe({error:i=>this.setTableErrorData(i),next:i=>this.setTableData(i)})}setTableErrorData(s){this.columns=["id","email","role","name","options"],this.users=[],this.errorMsg=s.error.message,this.loadingService.toggleLoading(!1)}setTableData(s){this.columns=["id","email","role","name","options"];const o=s.map(i=>({role:i.role.name,email:i.email,id:i.id,status:i.status,name:i.name,options:["edit","delete"]}));this.users=[...o],this.usersStore.updateDisplayedUsers(this.users),this.loadingService.toggleLoading(!1)}pageChanged(s){this.paginatorState={...s},this.loadingService.toggleLoading(!0),this.usersSubs=this.getUsers({limit:25,offset:25*s.pageIndex})}openDialog(){this.searchStoreService.updateItems([]),this.itemsFromSearchSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.dialogService.openDialog({component:S.I,callback:()=>{this.tableStoreService.setTableContext("user"),this.itemsFromSearchSubs=this.searchStoreService.itemsFromSearch$.subscribe(this.handleItemsFromSearch),this.valueSearchSubs=this.searchStoreService.value$.subscribe(this.handleValueSearchSubs),this.userCountSubs=this.usersService.getCount().subscribe(s=>{this.userCount=s})},data:{title:"Nuevo Usuario"}})}ngOnDestroy(){this.newUserFormIsOpenSubs?.unsubscribe(),this.userCountSubs?.unsubscribe(),this.usersSubs?.unsubscribe(),this.valueSearchSubs?.unsubscribe(),this.loadingSubs?.unsubscribe(),this.paginatorSubs?.unsubscribe(),this.updatedUserSubs?.unsubscribe(),this.newUserSubs?.unsubscribe(),this.userStatusSubs?.unsubscribe(),this.deleteUserSubs?.unsubscribe()}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(g.x),e.Y36(m.f),e.Y36(p.w),e.Y36(b.b),e.Y36(v.w),e.Y36(f.y),e.Y36(U.B))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-users"]],decls:9,vars:5,consts:[[3,"context"],["mat-raised-button","","color","primary",1,"button",3,"click"],[3,"dataToDisplay","displayedColumns","errorMsg",4,"ngIf","ngIfElse"],["searchTable",""],[3,"pageSize","count"],[3,"dataToDisplay","displayedColumns","errorMsg"]],template:function(s,o){if(1&s&&(e.TgZ(0,"h1"),e._uU(1,"Usuarios"),e.qZA(),e.TgZ(2,"app-search",0)(3,"button",1),e.NdJ("click",function(){return o.openDialog()}),e._uU(4,"Agregar nuevo usuario"),e.qZA()(),e.YNc(5,T,1,3,"app-table",2),e.YNc(6,M,1,3,"ng-template",null,3,e.W1O),e._UZ(8,"app-paginator",4)),2&s){const i=e.MAs(7);e.xp6(2),e.Q6J("context","users"),e.xp6(3),e.Q6J("ngIf",!o.isSearching)("ngIfElse",i),e.xp6(3),e.Q6J("pageSize",o.limitAndOffsetAndSize.limit)("count",o.userCount)}},dependencies:[u.O5,C.g,x.a,y.J,I.lW],styles:["h1[_ngcontent-%COMP%]{margin:20px}.button[_ngcontent-%COMP%]{max-height:50px!important}"]}),t})()}];let D=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.Bz.forChild(F),h.Bz]}),t})();var A=r(82),J=r(4006);let O=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[u.ez,l.K,c.JF,A.q,D,J.UX]}),t})()}}]);